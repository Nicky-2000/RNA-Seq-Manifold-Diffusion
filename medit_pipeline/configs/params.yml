seed: 7
hvg_n_top_genes: 2000

spec:
  n_pcs: 20
  dcol_max_cells: 3000
  ari_label_key: "paul15_clusters"        # <-- this must match an obs column name      # <-- this must match an obs column name
  ari_n_dims: 10              # how many dims to use for ARI per embedding

qc:
  min_cells: 500
  min_genes: 200
  max_pct_mt: 15


eggfm_model:
  hidden_dims: [256, 256]   # smaller net for paul15

eggfm_train:
  batch_size: 2048
  num_epochs: 50      # still the hard cap
  lr: 1e-3
  sigma: 0.05
  device: "cuda"

  early_stop_patience: 5        # e.g., stop if 5 epochs with no improvement
  early_stop_min_delta: 0.0     # or 1e-3 if you want a margin


eggfm_diffmap:
  n_neighbors: 30
  n_comps: 30
  device: "cuda"
  hvp_batch_size: 1024      # now just edge_batch_size
  eps_mode: "median"
  eps_value: 1.0
  eps_trunc: "no"
  t: 1.0

  # NEW: energy-based conformal metric hyperparams
  metric_gamma: 0.2         # baseline metric weight
  metric_lambda: 4.0        # how strongly energy rescales distances
  energy_clip_low: 0.05     # quantile for lower energy clipping
  energy_clip_high: 0.95    # quantile for upper energy clipping
  energy_batch_size: 2048   # batch size for E(x) computation